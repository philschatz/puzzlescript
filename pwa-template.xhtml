<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">

<head>
    <title>Accessible PuzzleScript Games</title>
    <link rel="stylesheet" href="./style.css"/>
    <style>
        /* Progressive Web App (PWA) media query. 
         * See https://stackoverflow.com/a/52695341
         * See https://developer.mozilla.org/en-US/docs/Web/CSS/@media/display-mode
         */
        @media all and (display-mode: standalone) {
            /* #headingSection, Uncommenting this causes horizontal lines on Android */
            #keyboardInstructionsSection,
            #disableCssSection,
            #instructionsContainer,
            #gamepadSection { display: none; }
            #gamepadSectionPWA { display: block; }
        }
        /* Hide by default */
        #gamepadSectionPWA { display: none; }

        /* Show instructions depending on whether the user has a keyboard, touch screen, or both */
        /* https://stackoverflow.com/a/52854585 */
        #touchInstructionsSection { opacity: 0.25; }
        @media (any-pointer: coarse) {
            #touchInstructionsSection { opacity: 1; }
            #keyboardInstructionsSection { display: none; }
        }        

        body {
            font-size: 12px;
            font-family: helvetica, arial, sans-serif; 
        }
        .hidden { display: none; }
        .light { opacity: .5; }
        kbd {
            font: 11px "SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;
            display: inline-block;
            padding: 3px 5px;
            font-size: 11px;
            line-height: 10px;
            color: #444d56;
            vertical-align: middle;
            background-color: #fafbfc;
            border: solid 1px #c6cbd1;
            border-bottom-color: #959da5;
            border-radius: 3px;
            box-shadow: inset 0 -1px 0 #959da5;
        }
        hr {
            border-style: solid;
            border-top: 0;
            border-bottom: 1px solid #ccc;
        }

        /* Decide whether to move the following (all) to the html-table.css file */

        /* When the CSS is disabled then show a plain table with borders */
        .ps-table.ps-ui-disabled {
            width: 100%;
            background-color: white;
        }
        .ps-table.ps-ui-disabled td {
            border: 1px solid #ccc;
        }
        .ps-table.ps-ui-disabled caption {
            background-color: white;
        }

        /* When the CSS is disabled, still mark the player cell in bold */
        table.ps-table .ps-cell-label.ps-player {
            font-weight: bold;
        }

        #gamepadIcon:not(.enabled) {
            filter: grayscale(100%);
            opacity: .5;
        }

        /* Style the message dialog */
        dialog {
            border-radius: 6px;
            /* border: 1px solid rgba(0, 0, 0, 0.3); */
            /* box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3); */
        }

        label { cursor: pointer; }

        h1 { font-size: 1.5rem; }
        .panel-header {
            display: flex;
            align-items: flex-start;
            padding: .5rem .5rem;
            border-bottom: 1px solid #dee2e6;
        }
        .panel-header > .panel-title {
            font-size: 1.25rem;
            white-space: nowrap;
            margin-top: 0;
            margin-bottom: 0;
            font-size: 1.25rem;
            flex-grow: 1;
        }
        .panel-header > .close {
            cursor: pointer;
            background-color: transparent;
            border: 0;

            /* padding: 1rem 1rem; */
            margin: -1rem -1rem -1rem auto;
            /* float: right; */
            flex-grow: 0;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
            color: #000;
            text-shadow: 0 1px 0 #fff;
            opacity: .5;
        }

        #infoContainer,
        #instructionsContainer {
            background-color: white;
            padding: 1rem;
            border-radius: 6px;
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
            margin-right: 1rem; /* Keep some room between the bubble and the game */
        }

        @media screen and (orientation:portrait) {
            body {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            #infoContainer {
                flex-grow: 1;
            }
            #theGame {
                /* Ensure the game is always big */
                flex-shrink: 0;
                margin-top: 1rem;
                margin-bottom: 1rem;
            }
            #instructionsContainer {
                flex-grow: 1;
            }
        }

        @media screen and (orientation:landscape) {
            body {
                display: flex;
                flex-direction: row;
                align-items: start;
            }
            #infoContainer {
                flex-grow: 1;
                max-width: 20rem;
            }
            #theGame {
                /* Ensure the game is always big */
                flex-shrink: 0;
                
                /* Important because the ResizeHandler does not know how to compute with margins yet */
                margin: 0;
            }
            #instructionsContainer {
                flex-grow: 1;
                max-width: 20rem;
            }
        }

        button.ui-button {
            cursor: pointer;
            padding: 0.5rem;
            border: 1px solid #666;
            border-radius: 6px;

            color: white;
            background-color: rgba(90, 90, 238, 1);
            box-shadow: 0 3px 7px rgba(0, 0, 0, 0.3);
        }
        #gameInstructionsButton {
            float: right;
            padding: 0.25rem;
        }

        .ui-features-list { 
            list-style-type: none;
            padding-inline-start: 0;
        }

        .ui-features-list li {
            margin-bottom: 1rem;
            border-left: 2px solid rgba(90, 90, 238);
            padding-left: .5rem;
        }

        /* =================================================
         * FullScreen controls and styles 
         * =================================================
         */

        /* NOTE: Using a comma does not work in chrome, so they are enumerated */
        /* :fullscreen #theGame { margin: auto; }
        :-webkit-full-screen #theGame { margin: auto; }
        :-moz-full-screen #theGame { margin: auto; }
        :-ms-fullscreen #theGame { margin: auto; } */
        body.is-zen-screen #fullscreenRoot { margin: auto; }

        #fullscreenButtons {
            position: fixed;
            top: 0;
            left: 0;
        }
        /* Make the background transparent in case the buttons cover the game */
        #fullscreenButtons .ui-button {
            background-color: rgba(90, 90, 238, 0.5);
        }

        body:not(.is-zen-screen) #fullscreenButtons { display: none; }

        #messageDialogClose,
        #exitFullscreen {
            margin: 0.5rem;
        }

        /* NOTE: Using a comma does not work in chrome, so they are enumerated */
        /* :fullscreen #exitFullscreen { display: block; }
        :-webkit-full-screen #exitFullscreen { display: block; }
        :-moz-full-screen #exitFullscreen { display: block; }
        :-ms-fullscreen #exitFullscreen { display: block; }
        body.is-zen-screen #exitFullscreen { display: block; } */

        body.is-zen-screen #infoContainer,
        body.is-zen-screen #instructionsContainer { display: none; }


        /* dialog-polyfill.css */
        dialog {
            position: absolute;
            left: 0; right: 0;
            width: -moz-fit-content;
            width: -webkit-fit-content;
            width: fit-content;
            height: -moz-fit-content;
            height: -webkit-fit-content;
            height: fit-content;
            margin: auto;
            padding: 1em;
            background: white;
            color: black;
            display: block;
        }
        dialog:not([open]) {
            display: none;
        }
        dialog + .backdrop {
            position: fixed;
            top: 0; right: 0; bottom: 0; left: 0;
            background: rgba(0,0,0,0.5);
        }
        ._dialog_overlay {
            position: fixed;
            top: 0; right: 0; bottom: 0; left: 0;
        }
        dialog.fixed {
            position: fixed;
            top: 50%;
            transform: translate(0, -50%);
        }
    </style>

    <meta charset="utf-8"/>
    <meta name="description" content="Accessible Puzzle Videogames"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"/>
    <meta name="theme-color" content="#ffffff"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <link rel="preconnect" href="https://google-analytics.com"/>
    <link rel="manifest" href="./pwa-manifest.json"/>
    <link rel="preload" href="./puzzlescript-webworker.js" as="script"/>
    <script src="./pwa-sw-loader.js" async="async"></script>
</head>

<body>
    <dialog id="messageDialog">
        <p id="messageDialogText"></p>
        <button id="messageDialogClose" title="Close this window" class="ui-button">Close</button>
    </dialog>
    
    <div id="infoContainer">
        <div class="panel-header">
            <h1 id="headingSection" class="panel-title">Accessible <a href="https://github.com/philschatz/puzzlescript" target="_window">Puzzle Games</a></h1>
            <button id="enterFullscreen" aria-label="Hide Game Selection Menu" class="close">
                <span aria-hidden="true">×</span>
            </button>
        </div>

        <p id="gameSelectionSection">
            <button id="btnAdd" class="hidden">Add to Homescreen?</button>
            <label for="gameSelection">Currently playing:</label>
            <select id="gameSelection">

                <option value="icecrates">IceCrates⁣</option>
                <option value="push">PUSH⁣</option>
                <option value="pot-wash-panic">Pot Wash Panic</option>
                <option value="sokobond">Sokobond: The Demake</option>
                <option value="pushcat-jr">Pushcat Jr⁣</option>

                <option value="pants-shirt-cap">Pants, Shirt, Cap⁣</option>
                <option value="hack-the-net">Hack the Net⁣</option>
                <option value="mirror-isles">Mirror Isles⁣</option>
                <option value="swapbot">SwapBot⁣</option>
                <option value="spikes-n-stuff">Spikes 'n' Stuff⁣</option>

                <option value="beam-islands">Beam Islands⁣</option>
                <option value="entanglement-one">Entanglement - Chapter One⁣</option>
                <option value="cyber-lasso">Cyber-Lasso⁣</option>
                <option value="some-lines-crossed">Some lines were meant to be crossed⁣</option>

                <option value="skipping-stones">Skipping Stones to Lonely Homes⁣</option>
                <option value="bubble-butler">Bubble Butler: CMD REORGANIZE⁣</option>
                <option value="roll-those-sixes">Roll those Sixes⁣</option>
                <option value="rock-paper-scissors">Rock, Paper, Scissors (v0.90 = v1.alpha)⁣</option>
                <option value="sleepy-players">Sleepy players⁣</option>
    
                <option value="boxes-and-balloons">Boxes &amp; Balloons⁣</option>
                <option value="aunt-flora-s-mansion">Aunt Flora's Mansion</option>
                <option value="separation">Separation⁣</option>
                <option value="spacekoban">Spacekoban⁣</option>
                <option value="castlemouse">Memories Of Castlemouse⁣</option>

                <option value="spooky-pumpkin-game">Spooky Pumpkin Game⁣</option>
                <option value="miss-direction">Miss Direction⁣</option>
                <option value="boxes-love-bloxing-gloves">Boxes Love Bloxing Gloves⁣</option>
                <option value="islands">Islands⁣</option>
                <option value="sokoboros">Sokoboros⁣</option>
    
            </select>
    
            <span id="loadingIndicator" class="hidden">Loading...</span>
        </p>
    
        <p id="authorSection" class="hidden"><small>By <a id="authorInfo" target="_window"></a></small></p>

        <hr/>
        
        <h3><button id="gameInstructionsButton" class="ui-button">Help</button> Features</h3>

        <ul class="ui-features-list">
            <li id="disableCssSection"><input id="disableCss" type="checkbox"/> <label for="disableCss"><strong>Check</strong> to see what a non-sighted user would experience (disables CSS)</label></li>
            <li>Install as a mobile app by opening on a phone/tablet</li>
            <li id="gamepadSection">
                <img id="gamepadIcon" alt="gamepad icon" width="20" height="20" src="./pwa-icon.svg"/>
                <span id="gamepadDisabled" class="hidden"><strong>Tip:</strong> Connect a gamepad controller (XBOX/PS3/PS4/etc) to use it to play.</span>
                <span id="gamepadRecognized" class="hidden">Gamepad is detected. You can play using it now. Just make sure the game is focused.</span>
                <span id="gamepadNotRecognized" class="hidden">Gamepad is detected but not recognized. Please submit an Issue on the Repository and we will help get it added</span>
            </li>
        </ul>

    
    </div>
    
    <div id="fullscreenRoot">            
        <table id="theGame" aria-labelledby="keyboardInstructionsSection">
            <caption>
                Game info goes here. like the current level, the goal, etc.
                <!-- See https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions -->
                <div role="log" aria-live="polite">The Game log</div>
            </caption>
        </table>
        
        <div id="fullscreenButtons">
            <button id="exitFullscreen" class="ui-button">Show Menu</button>
            <button id="gameInstructionsButton2" class="ui-button">Help</button>
        </div>
    </div>


    <dialog id="gameInstructionsDialog">
        <div class="panel-header">
            <h2 class="panel-title">How to Play</h2>
        </div>
        
        <div id="keyboardInstructionsSection">
            <p>To play with a keyboard:</p>
            <ul>
                <li>Arrow keys or <kbd>W</kbd>, <kbd>S</kbd>, <kbd>A</kbd>, <kbd>D</kbd> to move</li>
                <li><kbd>X</kbd> to perform an Action</li>
                <li><kbd>Z</kbd> or <kbd>U</kbd> for Undo</li>
                <li><kbd>R</kbd> to Restart the current level</li>
            </ul>
        </div>

        <div id="touchInstructionsSection">
            <p>To play with a touch screen:</p>
            <ul>
                <li><strong>Swipe</strong> up, down, left, or right to move</li>
                <li><strong>Tap</strong> to perform an Action</li>
                <li><strong>Touch and Hold</strong> to Undo</li>
                <li><strong>Touch and Hold for a few seconds</strong> to Restart the current level</li>
            </ul>
        </div>
        
        <div id="gamepadSectionPWA">
            <p>
                <img alt="gamepad icon" width="42" height="42" src="./pwa-icon.svg"/>
                <strong>Tip:</strong> Optionally, connect a gamepad controller (XBOX/PS3/PS4/etc) via BlueTooth to play games.
            </p>
            <p>
                Partial Gamepad support. Up/Down/Left/Right works but not Action/Undo. See this <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=906347">Chrome Bug</a>
            </p>
        </div>
    
        <button id="gameInstructionsDialogClose" title="Close" class="ui-button">Close</button>
    </dialog>

    <script type="text/javascript">//<![CDATA[
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-48498113-4', 'philschatz.com');
        ga('send', 'pageview');

        // Try to signal to Chrome that we are looking to use the real gamepad, not just up/down/left/right arrow keys mapped from a gamepad
        window.addEventListener("gamepadconnected", () => {})
        if (typeof navigator !== 'undefined' && navigator.getGamepads) {
            navigator.getGamepads()
        } else {
            setTimeout(() => {
                navigator.getGamepads()
            }, 1)
        }
    // ]]></script>
</body>

</html>